# 1) ë¹Œë“œ ìŠ¤í…Œì´ì§€: pnpm + Vite
FROM node:22-alpine AS builder
WORKDIR /app
RUN corepack enable && corepack prepare pnpm@latest --activate
COPY package.json pnpm-lock.yaml* ./
RUN pnpm install
COPY . .

# ğŸ”¥ Jenkinsì—ì„œ ì„¤ì •í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ ë¹Œë“œ ì‹œì ì— ë°›ì•„ì˜µë‹ˆë‹¤
ARG VITE_API_BASE_URL

# ğŸ”¥ ARGë¡œ ë°›ì€ ê°’ì„ ENVë¡œ ì„¤ì • (Vite ë¹Œë“œ ê³¼ì •ì—ì„œ ì‚¬ìš©ë¨)
ENV VITE_API_BASE_URL=$VITE_API_BASE_URL

RUN pnpm run build

# 2) ë°°í¬ ìŠ¤í…Œì´ì§€: Nginx
FROM nginx:1.25-alpine

RUN rm -f /etc/nginx/conf.d/*.conf

ARG ENV=test
COPY docker/nginx/${ENV}.conf /etc/nginx/conf.d/default.conf

# 2-3) ì •ì  íŒŒì¼ ë³µì‚¬
COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 80
CMD ["nginx","-g","daemon off;"]
